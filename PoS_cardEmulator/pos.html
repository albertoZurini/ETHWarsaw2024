<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POS</title>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <h1>POS</h1>
    <h1 id="walletId"></h1>
    
    <button onclick="switchNetwork('0xaa37dc')">Switch to Optimism Sepolia</button>
    <button onclick="switchNetwork('0xaef3')">Switch to Celo testnet</button>

    <button onclick="sellProduct(10)">Sell product</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.7.4-rc.1/web3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="/socket.io/socket.io.js"></script>

 <script>
        const socket = io();

        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value;
            if (message) {
                socket.emit('broadcast message', message);
                messageInput.value = '';
            }
        }

        socket.on('broadcast message', (msg) => {
            const messages = document.getElementById('messages');
            const li = document.createElement('li');
            li.textContent = msg;
            messages.appendChild(li);
        });

var walletAddress;

async function connect() {
  if (window.ethereum) {
     await window.ethereum.request({ method: "eth_requestAccounts" });
     window.web3 = new Web3(window.ethereum);
     const account = web3.eth.accounts;
     //Get the current MetaMask selected/active wallet
     walletAddress = account.givenProvider.selectedAddress;
     $("#walletId").text(`Connected wallet: ${walletAddress}`)
  
  } else {
   console.log("No wallet");
  }
}

connect()

var CHAINID;
async function switchNetwork(chainId){
    CHAINID = chainId;
    await window.ethereum.request({
    method: 'wallet_switchEthereumChain',
    params: [{ chainId: chainId }], // chainId must be in hexadecimal numbers
    });

}

async function sellProduct(price){
    socket.emit('setPrice', {
        chainId: CHAINID,
        price: price,
        address: walletAddress
    });
}
    </script>
</body>
</html>